/*
The MIT License (MIT)

Copyright (c) 2019 EDF Energy

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.
*/

#ifndef __integration__
#define __integration__

/* order 1 */
static const uniform REAL I_TET1_X[] = {0.25};
static const uniform REAL I_TET1_Y[] = {0.25};
static const uniform REAL I_TET1_Z[] = {0.25};
static const uniform REAL I_TET1_W[] = {0.16666666666666666};
#define                   I_TET1_N      1

static const uniform REAL I_PYR1_X[] = {0.00};
static const uniform REAL I_PYR1_Y[] = {0.00};
static const uniform REAL I_PYR1_Z[] = {0.25};
static const uniform REAL I_PYR1_W[] = {1.333333333333333333};
#define                   I_PYR1_N      1

static const uniform REAL I_WED1_X[] = {0.25};
static const uniform REAL I_WED1_Y[] = {0.25};
static const uniform REAL I_WED1_Z[] = {0.00};
static const uniform REAL I_WED1_W[] = {0.333333333333333333};
#define                   I_WED1_N      1

static const uniform REAL I_HEX1_X[] = {0.0};
static const uniform REAL I_HEX1_Y[] = {0.0};
static const uniform REAL I_HEX1_Z[] = {0.0};
static const uniform REAL I_HEX1_W[] = {8.0};
#define                   I_HEX1_N      1

static const uniform REAL I_TRI1_X[] = {0.333333333333333333};
static const uniform REAL I_TRI1_Y[] = {0.333333333333333333};
static const uniform REAL I_TRI1_W[] = {0.5};
#define                   I_TRI1_N      1

static const uniform REAL I_QUA1_X [] = {0.0};
static const uniform REAL I_QUA1_Y [] = {0.0};
static const uniform REAL I_QUA1_W [] = {4.0};
#define                   I_QUA1_N       1

/* order 2 */
static const uniform REAL I_TET2_X [] = {0.13819660112501052, 0.13819660112501052, 0.13819660112501052, 0.58541019662496840};
static const uniform REAL I_TET2_Y [] = {0.13819660112501052, 0.13819660112501052, 0.58541019662496840, 0.13819660112501052};
static const uniform REAL I_TET2_Z [] = {0.13819660112501052, 0.58541019662496840, 0.13819660112501052, 0.13819660112501052};
static const uniform REAL I_TET2_W [] = {0.04166666666666666, 0.04166666666666666, 0.04166666666666666, 0.04166666666666666};
#define                   I_TET2_N       4

#define ISQR3_PYR1 0.263184055569714
#define ISQR3_PYR2 0.506616303349788
#define _1SUB_PYR1 0.544151844011225
#define _1SUB_PYR2 0.122514822655441
#define _1_WPYR1 0.100785882079825
#define _1_WPYR2 0.232547451253508
static const uniform REAL I_PYR2_X[] = {-ISQR3_PYR1,  ISQR3_PYR1, ISQR3_PYR1, -ISQR3_PYR1, -ISQR3_PYR2,  ISQR3_PYR2, ISQR3_PYR2, -ISQR3_PYR2};
static const uniform REAL I_PYR2_Y[] = {-ISQR3_PYR1, -ISQR3_PYR1, ISQR3_PYR1,  ISQR3_PYR1, -ISQR3_PYR2, -ISQR3_PYR2, ISQR3_PYR2,  ISQR3_PYR2};
static const uniform REAL I_PYR2_Z[] = {_1SUB_PYR1,  _1SUB_PYR1,  _1SUB_PYR1,  _1SUB_PYR1,  _1SUB_PYR2,  _1SUB_PYR2, _1SUB_PYR2,  _1SUB_PYR2};
static const uniform REAL I_PYR2_W[] = {_1_WPYR1, _1_WPYR1, _1_WPYR1, _1_WPYR1, _1_WPYR2, _1_WPYR2, _1_WPYR2,  _1_WPYR2};
#define                   I_PYR2_N      8

#define ISQR3 0.57735026918962584 
static const uniform REAL I_WED2_X[] = {0.66666666666666667, 0.16666666666666667, 0.16666666666666667, 0.66666666666666667, 0.16666666666666667, 0.16666666666666667};
static const uniform REAL I_WED2_Y[] = {0.16666666666666667, 0.66666666666666667, 0.16666666666666667, 0.16666666666666667, 0.66666666666666667, 0.16666666666666667};
static const uniform REAL I_WED2_Z[] = {-ISQR3, -ISQR3, -ISQR3, ISQR3, ISQR3, ISQR3};
static const uniform REAL I_WED2_W[] = {0.16666666666666667, 0.16666666666666667, 0.16666666666666667, 0.16666666666666667, 0.16666666666666667, 0.16666666666666667};
#define                   I_WED2_N      6

static const uniform REAL I_HEX2_X [] = {-ISQR3,  ISQR3,  ISQR3, -ISQR3, -ISQR3,  ISQR3, ISQR3, -ISQR3};
static const uniform REAL I_HEX2_Y [] = {-ISQR3, -ISQR3,  ISQR3,  ISQR3, -ISQR3, -ISQR3, ISQR3,  ISQR3};
static const uniform REAL I_HEX2_Z [] = {-ISQR3, -ISQR3, -ISQR3, -ISQR3,  ISQR3,  ISQR3, ISQR3,  ISQR3};
static const uniform REAL I_HEX2_W [] = {1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0};
#define                   I_HEX2_N       8

static const uniform REAL I_TRI2_X[] = {0.66666666666666667, 0.16666666666666667, 0.16666666666666667};
static const uniform REAL I_TRI2_Y[] = {0.16666666666666667, 0.66666666666666667, 0.16666666666666667};
static const uniform REAL I_TRI2_W[] = {0.16666666666666667, 0.16666666666666667, 0.16666666666666667};
#define                   I_TRI2_N      3

static const uniform REAL I_QUA2_X [] = {-ISQR3,  ISQR3, ISQR3, -ISQR3};
static const uniform REAL I_QUA2_Y [] = {-ISQR3, -ISQR3, ISQR3,  ISQR3};
static const uniform REAL I_QUA2_W [] = {1.0, 1.0, 1.0, 1.0};
#define                   I_QUA2_N       4

/* order 3 */
static const uniform REAL I_HEX3_X [] = {0.7745966692414834, -0.7745966692414834, -0.7745966692414834, -0.7745966692414834, -0.7745966692414834, -0.7745966692414834, -0.7745966692414834, -0.7745966692414834, -0.7745966692414834, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.7745966692414834, 0.7745966692414834, 0.7745966692414834, 0.7745966692414834, 0.7745966692414834, 0.7745966692414834, 0.7745966692414834, 0.7745966692414834, 0.7745966692414834};
static const uniform REAL I_HEX3_Y [] = {-0.7745966692414834, -0.7745966692414834, -0.7745966692414834, 0.0, 0.0, 0.0, 0.7745966692414834, 0.7745966692414834, 0.7745966692414834, -0.7745966692414834, -0.7745966692414834, -0.7745966692414834, 0.0, 0.0, 0.0, 0.7745966692414834, 0.7745966692414834, 0.7745966692414834, -0.7745966692414834, -0.7745966692414834, -0.7745966692414834, 0.0, 0.0, 0.0, 0.7745966692414834, 0.7745966692414834, 0.7745966692414834};
static const uniform REAL I_HEX3_Z [] = {-0.7745966692414834, 0.0, 0.7745966692414834, -0.7745966692414834, 0.0, 0.7745966692414834, -0.7745966692414834, 0.0, 0.7745966692414834, -0.7745966692414834, 0.0, 0.7745966692414834, -0.7745966692414834, 0.0, 0.7745966692414834, -0.7745966692414834, 0.0, 0.7745966692414834, -0.7745966692414834, 0.0, 0.7745966692414834, -0.7745966692414834, 0.0, 0.7745966692414834, -0.7745966692414834, 0.0, 0.7745966692414834};
static const uniform REAL I_HEX3_W [] = {0.1714677640603567, 0.27434842249657065, 0.1714677640603567, 0.27434842249657065, 0.43895747599451296, 0.27434842249657065, 0.1714677640603567, 0.27434842249657065, 0.1714677640603567, 0.27434842249657065, 0.43895747599451296, 0.27434842249657065, 0.438957475994513, 0.7023319615912208, 0.438957475994513, 0.27434842249657065, 0.43895747599451296, 0.27434842249657065, 0.1714677640603567, 0.27434842249657065, 0.1714677640603567, 0.27434842249657065, 0.43895747599451296, 0.27434842249657065, 0.1714677640603567, 0.27434842249657065, 0.1714677640603567};
#define                   I_HEX3_N    27 

/* order 4 */

static const uniform REAL I_HEX4_X [] = {-0.8611363115940526, -0.8611363115940526, -0.8611363115940526, -0.8611363115940526, -0.8611363115940526, -0.8611363115940526, -0.8611363115940526, -0.8611363115940526, -0.8611363115940526, -0.8611363115940526, -0.8611363115940526, -0.8611363115940526, -0.8611363115940526, -0.8611363115940526, -0.8611363115940526, -0.8611363115940526, -0.3399810435848563, -0.3399810435848563, -0.3399810435848563, -0.3399810435848563, -0.3399810435848563, -0.3399810435848563, -0.3399810435848563, -0.3399810435848563, -0.3399810435848563, -0.3399810435848563, -0.3399810435848563, -0.3399810435848563, -0.3399810435848563, -0.3399810435848563, -0.3399810435848563, -0.3399810435848563, 0.3399810435848563, 0.3399810435848563, 0.3399810435848563, 0.3399810435848563, 0.3399810435848563, 0.3399810435848563, 0.3399810435848563, 0.3399810435848563, 0.3399810435848563, 0.3399810435848563, 0.3399810435848563, 0.3399810435848563, 0.3399810435848563, 0.3399810435848563, 0.3399810435848563, 0.3399810435848563, 0.8611363115940526, 0.8611363115940526, 0.8611363115940526, 0.8611363115940526, 0.8611363115940526, 0.8611363115940526, 0.8611363115940526, 0.8611363115940526, 0.8611363115940526, 0.8611363115940526, 0.8611363115940526, 0.8611363115940526, 0.8611363115940526, 0.8611363115940526, 0.8611363115940526, 0.8611363115940526};
static const uniform REAL I_HEX4_Y [] = {-0.8611363115940526, -0.8611363115940526, -0.8611363115940526, -0.8611363115940526, -0.3399810435848563, -0.3399810435848563, -0.3399810435848563, -0.3399810435848563, 0.3399810435848563, 0.3399810435848563, 0.3399810435848563, 0.3399810435848563, 0.8611363115940526, 0.8611363115940526, 0.8611363115940526, 0.8611363115940526, -0.8611363115940526, -0.8611363115940526, -0.8611363115940526, -0.8611363115940526, -0.3399810435848563, -0.3399810435848563, -0.3399810435848563, -0.3399810435848563, 0.3399810435848563, 0.3399810435848563, 0.3399810435848563, 0.3399810435848563, 0.8611363115940526, 0.8611363115940526, 0.8611363115940526, 0.8611363115940526, -0.8611363115940526, -0.8611363115940526, -0.8611363115940526, -0.8611363115940526, -0.3399810435848563, -0.3399810435848563, -0.3399810435848563, -0.3399810435848563, 0.3399810435848563, 0.3399810435848563, 0.3399810435848563, 0.3399810435848563, 0.8611363115940526, 0.8611363115940526, 0.8611363115940526, 0.8611363115940526, -0.8611363115940526, -0.8611363115940526, -0.8611363115940526, -0.8611363115940526, -0.3399810435848563, -0.3399810435848563, -0.3399810435848563, -0.3399810435848563, 0.3399810435848563, 0.3399810435848563, 0.3399810435848563, 0.3399810435848563, 0.8611363115940526, 0.8611363115940526, 0.8611363115940526, 0.8611363115940526};
static const uniform REAL I_HEX4_Z [] = {-0.8611363115940526, -0.3399810435848563, 0.3399810435848563, 0.8611363115940526, -0.8611363115940526, -0.3399810435848563, 0.3399810435848563, 0.8611363115940526, -0.8611363115940526, -0.3399810435848563, 0.3399810435848563, 0.8611363115940526, -0.8611363115940526, -0.3399810435848563, 0.3399810435848563, 0.8611363115940526, -0.8611363115940526, -0.3399810435848563, 0.3399810435848563, 0.8611363115940526, -0.8611363115940526, -0.3399810435848563, 0.3399810435848563, 0.8611363115940526, -0.8611363115940526, -0.3399810435848563, 0.3399810435848563, 0.8611363115940526, -0.8611363115940526, -0.3399810435848563, 0.3399810435848563, 0.8611363115940526, -0.8611363115940526, -0.3399810435848563, 0.3399810435848563, 0.8611363115940526, -0.8611363115940526, -0.3399810435848563, 0.3399810435848563, 0.8611363115940526, -0.8611363115940526, -0.3399810435848563, 0.3399810435848563, 0.8611363115940526, -0.8611363115940526, -0.3399810435848563, 0.3399810435848563, 0.8611363115940526, -0.8611363115940526, -0.3399810435848563, 0.3399810435848563, 0.8611363115940526, -0.8611363115940526, -0.3399810435848563, 0.3399810435848563, 0.8611363115940526, -0.8611363115940526, -0.3399810435848563, 0.3399810435848563, 0.8611363115940526, -0.8611363115940526, -0.3399810435848563, 0.3399810435848563, 0.8611363115940526};
static const uniform REAL I_HEX4_W [] = {0.04209147749053145, 0.07891151579507055, 0.07891151579507055, 0.04209147749053145, 0.07891151579507055, 0.1479403360567813, 0.1479403360567813, 0.07891151579507055, 0.07891151579507055, 0.1479403360567813, 0.1479403360567813, 0.07891151579507055, 0.04209147749053145, 0.07891151579507055, 0.07891151579507055, 0.04209147749053145, 0.07891151579507055, 0.1479403360567813, 0.1479403360567813, 0.07891151579507055, 0.1479403360567813, 0.27735296695391304, 0.27735296695391304, 0.1479403360567813, 0.1479403360567813, 0.27735296695391304, 0.27735296695391304, 0.1479403360567813, 0.07891151579507055, 0.1479403360567813, 0.1479403360567813, 0.07891151579507055, 0.07891151579507055, 0.1479403360567813, 0.1479403360567813, 0.07891151579507055, 0.1479403360567813, 0.27735296695391304, 0.27735296695391304, 0.1479403360567813, 0.1479403360567813, 0.27735296695391304, 0.27735296695391304, 0.1479403360567813, 0.07891151579507055, 0.1479403360567813, 0.1479403360567813, 0.07891151579507055, 0.04209147749053145, 0.07891151579507055, 0.07891151579507055, 0.04209147749053145, 0.07891151579507055, 0.1479403360567813, 0.1479403360567813, 0.07891151579507055, 0.07891151579507055, 0.1479403360567813, 0.1479403360567813, 0.07891151579507055, 0.04209147749053145, 0.07891151579507055, 0.07891151579507055, 0.04209147749053145};
#define                   I_HEX4_N    64

/* minimal local coords */
const static uniform REAL mincoord [9][3] =
{{0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0},
 {0, 0, 0}, /* tet */
 {-1, -1, 0}, /* pyr */
 {0, 0, -1}, /* wed */
 {0, 0, 0},
 {-1, -1, -1}}; /* hex */

/* maximal local coords */
const static uniform REAL maxcoord [9][3] =
{{0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0},
 {1, 1, 1}, /* tet */
 {1, 1, 1}, /* pyr */
 {1, 1, 1}, /* wed */
 {0, 0, 0},
 {1, 1, 1}}; /* hex */

/* load 3D integrator data */
inline static uniform int integrator3d_load (uniform int type, uniform int order,
  const uniform REAL * uniform * uniform X, const uniform REAL * uniform * uniform Y,
  const uniform REAL * uniform * uniform Z, const uniform REAL * uniform * uniform W)
{
  uniform int N;

  switch (type)
  {
  case 4:
  {
    assert (order >= 1 && order <= 2);

    switch (order)
    {
    case 1:
    *X = I_TET1_X;
    *Y = I_TET1_Y;
    *Z = I_TET1_Z;
    *W = I_TET1_W;
     N = I_TET1_N;
    break;
    case 2:
    *X = I_TET2_X;
    *Y = I_TET2_Y;
    *Z = I_TET2_Z;
    *W = I_TET2_W;
     N = I_TET2_N;
    break;
    }
  }
  break;
  case 5:
  {
    assert (order >= 1 && order <= 2);

    switch (order)
    {
    case 1:
    *X = I_PYR1_X;
    *Y = I_PYR1_Y;
    *Z = I_PYR1_Z;
    *W = I_PYR1_W;
     N = I_PYR1_N;
    break;
    case 2:
    *X = I_PYR2_X;
    *Y = I_PYR2_Y;
    *Z = I_PYR2_Z;
    *W = I_PYR2_W;
     N = I_PYR2_N;
    break;
    }
  }
  break;
  case 6:
  {
    assert (order >= 1 && order <= 2);

    switch (order)
    {
    case 1:
    *X = I_WED1_X;
    *Y = I_WED1_Y;
    *Z = I_WED1_Z;
    *W = I_WED1_W;
     N = I_WED1_N;
    break;
    case 2:
    *X = I_WED2_X;
    *Y = I_WED2_Y;
    *Z = I_WED2_Z;
    *W = I_WED2_W;
     N = I_WED2_N;
    break;
    }
  }
  break;
  case 8:
  {
    assert (order >= 1 && order <= 4);

    switch(order)
    {
    case 1:
    *X = I_HEX1_X;
    *Y = I_HEX1_Y;
    *Z = I_HEX1_Z;
    *W = I_HEX1_W;
     N = I_HEX1_N;
    break;
    case 2:
    *X = I_HEX2_X;
    *Y = I_HEX2_Y;
    *Z = I_HEX2_Z;
    *W = I_HEX2_W;
     N = I_HEX2_N;
    break;
    case 3:
    *X = I_HEX3_X;
    *Y = I_HEX3_Y;
    *Z = I_HEX3_Z;
    *W = I_HEX3_W;
     N = I_HEX3_N;
    break;
    case 4:
    *X = I_HEX4_X;
    *Y = I_HEX4_Y;
    *Z = I_HEX4_Z;
    *W = I_HEX4_W;
     N = I_HEX4_N;
    break;
    }
  }
  break;
  }

  return N;
}

/* load 2D integrator data */
inline static uniform int integrator2d_load (uniform int type, uniform int order,
  const uniform REAL * uniform * uniform X, const uniform REAL * uniform * uniform Y,
  const uniform REAL * uniform * uniform W)
{
  uniform int N;

  assert (order >= 1 && order <= 2);

  switch (type)
  {
  case 3:
  {
    switch (order)
    {
    case 1:
    *X = I_TRI1_X;
    *Y = I_TRI1_Y;
    *W = I_TRI1_W;
     N = I_TRI1_N;
    break;
    case 2:
    *X = I_TRI2_X;
    *Y = I_TRI2_Y;
    *W = I_TRI2_W;
     N = I_TRI2_N;
    break;
    }
  }
  break;
  case 4:
  {
    switch (order)
    {
    case 1:
    *X = I_QUA1_X;
    *Y = I_QUA1_Y;
    *W = I_QUA1_W;
     N = I_QUA1_N;
    break;
    case 2:
    *X = I_QUA2_X;
    *Y = I_QUA2_Y;
    *W = I_QUA2_W;
     N = I_QUA2_N;
    break;
    }
  }
  break;
  }

  return N;
}

/* element integral begins */
#define INTEGRAL3D_BEGIN(TYPE, ORDER)\
{\
  uniform int __N__;\
  const uniform REAL * uniform __X__;\
  const uniform REAL * uniform __Y__;\
  const uniform REAL * uniform __Z__;\
  const uniform REAL * uniform __W__;\
  REAL point [3], weight;\
  int __k__, __l__;\
\
  __N__ = integrator3d_load (TYPE, ORDER, &__X__, &__Y__, &__Z__, &__W__);\
  for (__k__ = 0; __k__ < __N__; __k__ ++)\
  {\
    point [0] = __X__ [__k__];\
    point [1] = __Y__ [__k__];\
    point [2] = __Z__ [__k__];\
    weight = __W__ [__k__];\

/* integration code in between
 * uses point and weight values */

/* element integral ends */
#define INTEGRAL3D_END()\
  }\
}

/* face integral begins */
#define INTEGRAL2D_BEGIN(TYPE, ORDER)\
{\
  uniform int __N__;\
  const uniform REAL * uniform __X__;\
  const uniform REAL * uniform __Y__;\
  const uniform REAL * uniform __W__;\
  REAL point [2], weight;\
  int __k__;\
\
  __N__ = integrator2d_load (TYPE, ORDER, &__X__, &__Y__, &__W__);\
  for (__k__ = 0; __k__ < __N__; __k__ ++)\
  {\
    point [0] = __X__ [__k__];\
    point [1] = __Y__ [__k__];\
    weight = __W__ [__k__];\

/* integration code in between
 * uses point and weight values */

/* face integral ends */
#define INTEGRAL2D_END()\
  }\
}

#endif
